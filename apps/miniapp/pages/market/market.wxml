<!-- pages/market/market.wxml -->
<view class="market-container">
  <!-- éª¨æ¶å± -->
  <skeleton 
    show="{{loading && !refreshing}}"
    type="market"
    count="{{8}}"
    show-avatar="{{false}}"
  />
  
  <!-- é”™è¯¯å ä½ -->
  <error-placeholder 
    show="{{error && !loading}}"
    type="{{errorType}}"
    title="{{errorTitle}}"
    description="{{errorDescription}}"
    show-retry="{{true}}"
    show-refresh="{{true}}"
    bind:retry="handleRetry"
    bind:refresh="handleRefresh"
  />
  
  <!-- ä¸»è¦å†…å®¹ -->
  <view class="market-content" wx:if="{{!loading && !error}}">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input" bindtap="onSearchTap">
      <text class="search-placeholder">æœç´¢è‚¡ç¥¨ä»£ç /åç§°</text>
      <text class="search-icon">ğŸ”</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="content">
    <!-- å¸‚åœºæ¦‚è§ˆ -->
    <view class="market-overview">
      <view 
        class="market-item" 
        wx:for="{{[marketData.sh, marketData.sz, marketData.cy]}}" 
        wx:key="code"
        bindtap="onMarketTap" 
        data-code="{{item.code}}"
      >
        <view class="market-info">
          <text class="market-name">{{item.name}}</text>
          <text class="market-code">{{item.code}}</text>
        </view>
        <view class="market-data">
          <text class="market-price">{{formatPrice(item.price)}}</text>
          <text class="market-change {{getChangeColorClass(item.change)}}">
            {{formatChange(item.change)}} ({{formatChangePercent(item.changePercent)}})
          </text>
        </view>
      </view>
    </view>

    <!-- æ ‡ç­¾åˆ‡æ¢ -->
    <view class="tab-bar">
      <view 
        class="tab-item {{currentTab === index ? 'active' : ''}}" 
        wx:for="{{tabs}}" 
        wx:key="*this"
        bindtap="onTabChange" 
        data-index="{{index}}"
      >
        <text class="tab-text">{{item}}</text>
      </view>
    </view>

    <!-- æ’åºæ  -->
    <view class="sort-bar">
      <view class="sort-item" bindtap="onSort" data-field="name">
        <text class="sort-text">åç§°</text>
      </view>
      <view class="sort-item" bindtap="onSort" data-field="price">
        <text class="sort-text">ç°ä»· {{getSortIcon('price')}}</text>
      </view>
      <view class="sort-item" bindtap="onSort" data-field="changePercent">
        <text class="sort-text">æ¶¨è·Œå¹… {{getSortIcon('changePercent')}}</text>
      </view>
      <view class="sort-item" bindtap="onSort" data-field="volume">
        <text class="sort-text">æˆäº¤é‡ {{getSortIcon('volume')}}</text>
      </view>
    </view>

    <!-- è‚¡ç¥¨åˆ—è¡¨ -->
    <scroll-view 
      scroll-y="true" 
      class="stock-scroll" 
      refresher-enabled="{{true}}" 
      refresher-triggered="{{refreshing}}" 
      bindrefresherrefresh="refreshData"
      bindscrolltolower="onReachBottom"
    >
      <view wx:if="{{stockList.length === 0}}" class="empty">
        <text class="empty-text">æš‚æ— æ•°æ®</text>
      </view>
      <view wx:else class="stock-list">
        <view 
          class="stock-item" 
          wx:for="{{stockList}}" 
          wx:key="code"
          bindtap="onStockTap" 
          data-code="{{item.code}}"
        >
          <view class="stock-info">
            <text class="stock-name">{{item.name}}</text>
            <text class="stock-code">{{item.code}}</text>
          </view>
          <view class="stock-price">
            <text class="price-value">{{formatPrice(item.price)}}</text>
          </view>
          <view class="stock-change">
            <text class="change-percent {{getChangeColorClass(item.change)}}">
              {{formatChangePercent(item.changePercent)}}
            </text>
            <text class="change-value {{getChangeColorClass(item.change)}}">
              {{formatChange(item.change)}}
            </text>
          </view>
          <view class="stock-volume">
            <text class="volume-value">{{formatVolume(item.volume)}}</text>
          </view>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore && !loading}}">
        <text class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>
      
      <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
      <view class="no-more" wx:if="{{!hasMore && stockList.length > 0}}">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
      </view>
    </scroll-view>
  </view>
</view>