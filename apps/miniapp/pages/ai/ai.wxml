<!--pages/ai/ai.wxml-->
<view class="container">
  <!-- éª¨æ¶å± -->
  <skeleton 
    show="{{loading && !refreshing}}"
    type="ai"
    count="4"
    show-avatar="{{true}}"
    show-subtitle="{{true}}"
  />
  
  <!-- é”™è¯¯å ä½ -->
  <error-placeholder
    show="{{error && !loading}}"
    type="{{errorType}}"
    title="{{errorTitle}}"
    description="{{errorDescription}}"
    show-retry="{{true}}"
    show-refresh="{{true}}"
    bind:retry="handleRetry"
    bind:refresh="handleRefresh"
  />
  
  <!-- ä¸»è¦å†…å®¹ -->
  <view class="ai-content" wx:if="{{!loading && !error}}">
  <!-- åˆ†æç±»å‹é€‰æ‹© -->
  <view class="analysis-types">
    <view class="section-title">é€‰æ‹©åˆ†æç±»å‹</view>
    <view class="type-grid">
      <view 
        class="type-item" 
        wx:for="{{analysisTypes}}" 
        wx:key="id"
        data-type="{{item.id}}"
        bindtap="onAnalysisTypeTap"
      >
        <view class="type-icon" style="color: {{item.color}}">{{item.icon}}</view>
        <view class="type-name">{{item.name}}</view>
        <view class="type-desc">{{item.description}}</view>
      </view>
    </view>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <view class="message-list">
    <view class="section-title">åˆ†æå¯¹è¯</view>
    <view 
      class="message-item {{item.type}}"
      wx:for="{{messages}}"
      wx:key="id"
    >
      <view class="message-header">
        <view class="message-avatar">
          <text wx:if="{{item.type === 'user'}}">ğŸ‘¤</text>
          <text wx:elif="{{item.type === 'ai'}}">ğŸ¤–</text>
          <text wx:else>â„¹ï¸</text>
        </view>
        <view class="message-info">
          <view class="message-sender">
            <text wx:if="{{item.type === 'user'}}">æ‚¨</text>
            <text wx:elif="{{item.type === 'ai'}}">AIåŠ©æ‰‹</text>
            <text wx:else>ç³»ç»Ÿ</text>
          </view>
          <view class="message-time">{{item.timestamp}}</view>
        </view>
      </view>
      <view class="message-content">
        <text>{{item.content}}</text>
      </view>
    </view>
    
    <!-- åˆ†æä¸­çŠ¶æ€ -->
    <view class="analyzing" wx:if="{{isAnalyzing}}">
      <view class="analyzing-icon">ğŸ¤–</view>
      <view class="analyzing-text">AIæ­£åœ¨åˆ†æä¸­...</view>
      <view class="analyzing-dots">
        <view class="dot"></view>
        <view class="dot"></view>
        <view class="dot"></view>
      </view>
    </view>
  </view>

  <!-- è¾“å…¥æ¡† -->
  <view class="input-area">
    <view class="input-wrapper">
      <input 
        class="message-input" 
        placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç æˆ–é—®é¢˜..." 
        value="{{inputValue}}"
        bindinput="onInputChange"
        bindconfirm="onSendMessage"
      />
      <button 
        class="send-btn {{inputValue ? 'active' : ''}}"
        bindtap="onSendMessage"
        disabled="{{!inputValue || isAnalyzing}}"
      >
        å‘é€
      </button>
    </view>
  </view>

    <!-- åˆè§„ç»„ä»¶ -->
    <view class="compliance-section">
      <disclaimer
        type="ai"
        position="bottom"
        theme="light"
        show-icon="{{true}}"
        closable="{{true}}"
        custom-class="ai-disclaimer"
      />
      <data-source-hint
        type="realtime"
        position="bottom"
        theme="light"
        show-icon="{{true}}"
        closable="{{true}}"
        custom-class="ai-data-hint"
      />
    </view>
  </view>
</view>